<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community Chat - Starlight Games</title>
    
    <script id="cloning-script" src="/js/cloner.js"></script>
    <script src="/js/settings.js"></script>

    <style>
        /* --- 1. Soft UI Theme Variables --- */
        :root {
            /* Light Mode Defaults */
            --bg-color: #e0e5ec;
            --text-color: #4a5568;
            --text-secondary: #718096;
            --card-bg: #e0e5ec;
            
            /* Neumorphism Shadows */
            --shadow-light: #ffffff;
            --shadow-dark: #a3b1c6;
            
            /* Accents */
            --primary-color: #4c68ff;
            --success-color: #008069;
            --warning-color: #f7941d;
            
            --font-stack: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        /* Dark Mode Overrides */
        [data-theme="dark"] {
            --bg-color: #292d32;
            --text-color: #e2e8f0;
            --text-secondary: #94a3b8;
            --card-bg: #292d32;
            
            --shadow-light: #353b42;
            --shadow-dark: #1e2125;
        }
        
        body {
            font-family: var(--font-stack);
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden; /* Prevent body scroll, let container handle it if needed */
            transition: background 0.3s ease;
        }

        /* --- 2. Main Layout & Container --- */
        .main-app-container {
            width: 90%;
            max-width: 1000px;
            height: 85vh;
            padding: 30px;
            background: var(--card-bg);
            border-radius: 20px;
            
            /* Neumorphic Outset Shadow */
            box-shadow: 
                15px 15px 30px var(--shadow-dark), 
                -15px -15px 30px var(--shadow-light);
            
            display: flex;
            flex-direction: column;
        }

        h1 {
            color: var(--primary-color);
            font-size: 1.8em;
            margin: 0 0 10px 0;
            text-shadow: 1px 1px 2px var(--shadow-dark), -1px -1px 2px var(--shadow-light);
        }

        p {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-bottom: 20px;
        }

        /* --- 3. Chat Embed Area (Recessed Screen) --- */
        .chat-embed-area {
            flex-grow: 1;
            border-radius: 15px;
            overflow: hidden;
            background-color: var(--bg-color);
            position: relative;
            
            /* Neumorphic Inset Shadow (Recessed look) */
            box-shadow: 
                inset 6px 6px 12px var(--shadow-dark), 
                inset -6px -6px 12px var(--shadow-light);
        }

        .chat-embed-area iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
        }

        /* --- 4. Footer Buttons --- */
        .footer-actions {
            margin-top: 25px;
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            flex-wrap: wrap;
        }

        .nav-button {
            padding: 12px 20px;
            font-size: 0.95em;
            font-weight: bold;
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            text-decoration: none;

            /* Button Shadow */
            box-shadow: 
                5px 5px 10px var(--shadow-dark), 
                -5px -5px 10px var(--shadow-light);
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 
                7px 7px 14px var(--shadow-dark), 
                -7px -7px 14px var(--shadow-light);
            filter: brightness(1.1);
        }

        .nav-button:active {
            transform: translateY(1px);
            box-shadow: inset 2px 2px 5px rgba(0,0,0,0.2);
        }

        /* Button Colors */
        .back-button { background-color: var(--primary-color); }
        .refresh-button { background-color: var(--success-color); }
        .fullscreen-button { background-color: var(--warning-color); }

        /* --- 5. Toast Notification Styles --- */
        #toast-container {
            visibility: hidden;
            min-width: 300px;
            background-color: var(--primary-color);
            color: #fff;
            text-align: center;
            border-radius: 12px;
            padding: 16px;
            position: fixed;
            z-index: 1000;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-size: 0.95em;
            line-height: 1.5;
            opacity: 0;
            transition: opacity 0.5s, top 0.5s;
        }

        #toast-container.show {
            visibility: visible;
            opacity: 1;
            top: 50px; /* Slight slide down effect */
        }
    </style>
</head>
<body>

    <script>
        // 1. APPLY THEME IMMEDIATELY
        (function() {
            try {
                const storedTheme = localStorage.getItem('theme');
                if (storedTheme === 'dark') {
                    document.documentElement.setAttribute('data-theme', 'dark');
                }
            } catch (e) {}
        })();
    </script>

    <div class="main-app-container">
        <h1>Starlight Games | Community Chat</h1>
        <p>For the best experience, we recommend using the fullscreen option, especially on Chromebooks.</p>
        
        <div class="chat-embed-area">
            <iframe id="chatFrame" src="/pages/chat_embed"></iframe>            
        </div>
        
        <div class="footer-actions">
            <button class="nav-button back-button" onclick="redirectToApp()">
                ← Back to App
            </button>
            
            <button class="nav-button refresh-button" onclick="refreshChat()">
                ↻ Refresh Chat
            </button>
            
            <button class="nav-button fullscreen-button" onclick="toggleFullscreen()">
                ⛶ Fullscreen
            </button>
        </div>
    </div>

    <div id="toast-container"></div>
    
    <script>
        // --- Constants ---
        const TITLE_KEY = 'customPageTitle';
        const FAVICON_KEY = 'customFaviconURL';

        // --- Core Functions ---
        function redirectToApp() {
            window.location.href = '/'; 
        }
        
        function refreshChat() {
            const iframe = document.getElementById('chatFrame');
            if (iframe) {
                iframe.src = iframe.src; 
                showToast("Chat refreshed!");
            }
        }

        function toggleFullscreen() {
            const chatFrame = document.getElementById('chatFrame');

            if (!document.fullscreenElement) {
                if (chatFrame.requestFullscreen) chatFrame.requestFullscreen();
                else if (chatFrame.mozRequestFullScreen) chatFrame.mozRequestFullScreen();
                else if (chatFrame.webkitRequestFullscreen) chatFrame.webkitRequestFullscreen();
                else if (chatFrame.msRequestFullscreen) chatFrame.msRequestFullscreen();
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
                else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
                else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
                else if (document.msExitFullscreen) document.msExitFullscreen();
            }
        }

        // --- Toast Logic ---
        function showToast(message, duration = 6000) {
            const toast = document.getElementById("toast-container");
            toast.textContent = message;
            
            // Add the 'show' class to make it visible
            toast.className = "show";
            
            // Hide it after 'duration' milliseconds
            setTimeout(function(){ 
                toast.className = toast.className.replace("show", ""); 
            }, duration);
        }

        // --- Cloak Logic ---
        function applyCustomCloak(customTitle, faviconURL) {
            if (customTitle) {
                document.title = customTitle;
                localStorage.setItem(TITLE_KEY, customTitle);
            }
            if (faviconURL) {
                localStorage.setItem(FAVICON_KEY, faviconURL);
                let faviconEl = document.getElementById("dynamic-favicon");
                if (!faviconEl) {
                    faviconEl = document.createElement("link");
                    faviconEl.rel = "icon";
                    faviconEl.id = "dynamic-favicon";
                    document.head.appendChild(faviconEl);
                }
                faviconEl.href = faviconURL;
            }
        }

        function applyStoredCloak() {
            const storedTitle = localStorage.getItem(TITLE_KEY);
            const storedFavicon = localStorage.getItem(FAVICON_KEY);
            if (storedTitle || storedFavicon) {
                applyCustomCloak(storedTitle, storedFavicon);
            } 
        }

        // --- Window Load Event ---
        window.addEventListener('load', () => {
            // 1. Apply Cloak
                setTimeout(applyStoredCloak, 800);


            // 2. Trigger Toast Notification (Always runs, no localstorage check)
            // Using a small delay (500ms) makes the animation feel smoother after load
            setTimeout(() => {
                showToast("NOTICE: Usernames & Passwords are Case Sensitive! If you don't have an account, please use Guest Mode.");
            }, 500);
        });

    </script>
</body>
</html>
